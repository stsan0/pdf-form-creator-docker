<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF Form Creator and Editor</title>
  <link rel="stylesheet" href="index.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
  <script src="scripts.js" type="module"></script>
  <ul class="flex items-center divide-x dark:text-white dark:divide-gray-700 text-gray-800 divide-gray-200">
    <h1 class="pl-3 pr-3 lg:pr-6 text-lg font-medium">Freightgate</h1>
  </ul>
  <div id="selector">
    <input type="file" id="pdf-file-input" accept=".pdf"> </input>
    <button id="loadPdfBtn">Load PDF</button>
    <button id="displayFieldsBtn"> Display Fields </button>
    <button id="showValuesBtn">Extract Field to List</button>
    <button id="editFormBtn">Save Form</button>
  </div>
  <div id="pdf-container">
    <div id="canvas"></div> <!-- Holds all editable-text-fields -->
    <canvas id="pdfframe"> </canvas> <!-- holds the pdf page display -->
  </div>
  <div id="toolbox">
    <div id="toolbox-field" draggable="true" data-field="editable-field">Text Field</div>
    <div id="fontControls">
      <label for="dataField"> Data Field: </label>
      <input type="text" id="dataField" value="dataField">
      <label for="innerText"> Inner Text: </label>
      <input type="text" id="innerText" value="innerText">
      <label for="fontSize">Font Size:</label>
      <input type="number" id="fontSize" value="12" min="6" max="48">
      <br></br>
      <label for="fontColor">Font Color:</label>
      <input type="color" id="fontColor" value="#000000">
      <br></br>
      <label for="fontStyle">Font Style:</label>
      <select id="fontStyle">
        <option value="normal">Normal</option>
        <option value="italic">Italic</option>
      </select>

      <select id="fontFamily">
        <option value="Arial">Arial</option>
        <option value="Courier New">Courier New</option>
        <option value="Verdana">Verdana</option>
        <option value="Times New Roman">Times New Roman</option>
        <option value="Tahoma">Tahoma</option>
        <option value="sans-serif">sans-serif</option>
      </select>
      <select id="fontWeight">
        <option value="normal">Normal</option>
        <option value="bold">Bold</option>
        <option value="lighter">Lighter</option>
      </select>


    </div>
  </div>
  <div id="fields-container"></div>
  <!-- The Modal -->
  <div id="myModal" class="modal">

    <!-- Modal content -->

    <div class="modal-content">
      <span class="close">&times;</span>
      <div class="modal-title"></div>
      <div class="modal-body">Some text in the Modal..</div>
      <button class="modal-cancel">Cancel</button>
      <button class="modal-ok">OK</button>

      <div style="clear: both;"></div>
    </div>

  </div>
  <script type="text/javascript">
    var efb = null;
    // modal logic
    var modal = document.getElementById("myModal");

    // Get the button that opens the modal

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];

    // When the user clicks on the button, open the modal
    function openModal(text = 'Generic text', title = 'Element') {
      document.querySelector('.modal-title').innerHTML = title;
      document.querySelector('.modal-body').innerHTML = text;
      modal.style.display = "block";
    }

    // When the user clicks on <span> (x), close the modal
    span.onclick = function () {
      efb = null;
      modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function (event) {
      if (event.target == modal) {
        efb = null;
        modal.style.display = "none";
      }
    }
    modalCancel = document.querySelector('.modal-cancel');
    modalOk = document.querySelector('.modal-ok');

    modalCancel.onclick = function () {
      efb = null;
      modal.style.display = "none";
    }
    modalOk.onclick = function () {
      //console.log(modal,modal.querySelector('#fontFamily').value);	
      efb.setAttribute('data-field', modal.querySelector('#dataField').value);
      efb.innerText = modal.querySelector('#innerText').value;
      // re-add the span "font-control fa fa-edit" to the element as a child
      efb.appendChild(document.createElement('span'));
      efb.lastChild.setAttribute('class', 'font-control fa fa-edit');

      efb.style.fontSize = modal.querySelector('#fontSize').value + 'px';
      efb.style.color = modal.querySelector('#fontColor').value;
      efb.style.fontFamily = modal.querySelector('#fontFamily').value;
      efb.style.fontStyle = modal.querySelector('#fontStyle').value;
      efb.style.fontWeight = modal.querySelector('#fontWeight').value;
      efb = null;
      modal.style.display = "none";

    }
    function aferIconCheck(e) {

      // First we get the pseudo-elements style
      const target = e.currentTarget || e.target
      const after = getComputedStyle(target, ":after")
      if (after) {
        // Then we parse out the dimensions
        const atop = Number(after.getPropertyValue("top").slice(0, -2))
        const aheight = Number(after.getPropertyValue("height").slice(0, -2))
        const aleft = Number(after.getPropertyValue("left").slice(0, -2))
        const awidth = Number(after.getPropertyValue("width").slice(0, -2))
        // And get the mouse position
        const ex = e.layerX
        const ey = e.layerY
        // Finally we do a bounds check (Is the mouse inside of the after element)
        if (ex > aleft && ex < aleft + awidth && ey > atop && ey < atop + aheight) {
          return true;
        }
        return false;
      }
    }
    function RGBToHex(rgb) {
      // Choose correct separator
      let sep = rgb.indexOf(",") > -1 ? "," : " ";
      // Turn "rgb(r,g,b)" into [r,g,b]
      rgb = rgb.substr(4).split(")")[0].split(sep);

      let r = (+rgb[0]).toString(16),
        g = (+rgb[1]).toString(16),
        b = (+rgb[2]).toString(16);

      if (r.length == 1)
        r = "0" + r;
      if (g.length == 1)
        g = "0" + g;
      if (b.length == 1)
        b = "0" + b;

      return "#" + r + g + b;
    }
    var greg = null;
  </script>
</body>

</html>